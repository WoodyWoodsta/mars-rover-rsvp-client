<!-- app-rover-sequence-editor.html -->
<!-- Custom Elements -->
<link rel="import" href="../app-panel/app-panel.html">
<link rel="import" href="../rover-sequence-item/rover-sequence-item.html">

<dom-module id="app-rover-sequence-editor">
  <template>
    <style include="paper-override-shared-styles"></style>
    <style include="app-general-shared-styles">
      :host {
        @apply(--layout-horizontal);
      }

      #editorContainer {
        @apply(--layout-vertical);
        @apply(--layout-flex-2);

        margin-right: var(--container-padding);
      }

      #panel {
        @apply(--layout-vertical);
        @apply(--layout-flex);

        padding: var(--container-padding);
      }

      #sidePanelWrapper {
        width: 45%;
      }

      #sortableWrapper {
        @apply(--layout-flex);

        overflow: auto;
      }

      rover-sequence-item:hover {
        background: var(--light-weak-alpha);
      }

      rover-sequence-item + rover-sequence-item {
        border-top: 1px solid var(--light-weak-alpha);
      }

      #sequenceControlsContainer {
        @apply(--layout-horizontal);

        margin-top: var(--element-padding);
        padding: var(--element-padding);
        border-radius: var(--border-radius);
        border: 1px solid var(--light-normal-alpha);
      }

      .spacer {
        @apply(--layout-flex);
      }

      paper-icon-button {
        width: 26px;
        height: 26px;
        
        --paper-icon-button: {
          padding: 2px;
        }
      }

      #cmdDialog {
        background-color: var(--dark-strong);
      }

      #cmdDialog > paper-dialog-scrollable {
        /*width: 30vw;*/

        --paper-dialog-scrollable: {
          /*@apply(--layout-vertical);*/
        };
      }

      paper-dropdown-menu.new-cmd {
        @apply(--layout-flex);
      }

      .input-row {
        @apply(--layout-horizontal);
        @apply(--layout-end);
      }

      .input-row > paper-input,
      .input-row > paper-slider,
      .input-row > paper-radio-group {
        @apply(--layout-flex);
      }

      .input-unit {
        margin-left: var(--container-padding);
        margin-bottom: var(--container-padding);
        font-size: 1rem;
        font-weight: 600;
      }
    </style>

    <!-- Sequence Editor Panel -->
    <div id="editorContainer">
      <div class="icon-heading">
        <iron-icon icon="rsvp:view-list"></iron-icon>
        <div class="app subheading">Sequence Editor</div>
      </div>
      <app-panel id="panel">
        <div id="sortableWrapper">
          <sortable-js group="sequenceSortable" draggable=".item" animation="100">
            <template is="dom-repeat" items="{{sequence}}" index-as="index">
              <rover-sequence-item class="item" data="{{item}}"></rover-sequence-item>
            </template>
          </sortable-js>
        </div>
        <div id="sequenceControlsContainer">
          <paper-icon-button id="addButton" icon="rsvp:add"></paper-icon-button>
          <div class="spacer"></div>
          <paper-icon-button icon="rsvp:play-arrow"></paper-icon-button>
          <paper-icon-button icon="rsvp:pause"></paper-icon-button>
        </div>
      </app-panel>
    </div>

    <!-- Side Panel -->
    <div id="sidePanelWrapper">
      <content select="[right]"></content>
    </div>

    <!-- Add Command Dialog -->
    <paper-dialog id="cmdDialog" with-backdrop>
      <h2>New Sequence Command</h2>
      <paper-dialog-scrollable>
        <!-- Command Dropdown -->
        <paper-dropdown-menu id="cmdTypeDropdown" class="new-cmd"
          label="Command"
          selected-item="{{_cmdTypeSelection}}"
          placeholder="Select a command"
          horizontal-offset="10"
          vertical-offset="10"
          always-float-label>
          <paper-listbox class="dropdown-content">
            <template is="dom-repeat" items="{{_cmdDefArray}}" index-as="index" sort="_sortCmdDefArray">
              <paper-item id="${item.def.name}Item" type="{{item.def.type}}" item="{{item}}" index="{{index}}">{{item.def.name}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>

        <!-- Command Parameters -->
        <!-- DriveCmd -->
        <template is="dom-if" if="{{_cmdTypeName.drive}}" restamp="true">
          <div class="input-row">
            <paper-input
              label="Duration"
              value="{{currentCmd.params.duration.value}}"
              placeholder="Enter a duration",
              type="number"
              always-float-label></paper-input>
            <span class="input-unit">{{currentCmd.params.duration.unit}}</span>
          </div>
          <div class="input-row">
            <label>Direction</label>
            <paper-radio-group selected="{{currentCmd.params.direction.value}}">
              <paper-radio-button name="fwd">Forward</paper-radio-button>
              <paper-radio-button name="rev">Reverse</paper-radio-button>
            </paper-radio-group>
          </div>
          <div class="input-row">
            <label>Velocity</label>
            <paper-slider min="0" max="100" editable value="{{currentCmd.params.velocity.value}}"></paper-slider>
          </div>
        </template>

        <!-- PauseCmd -->
        <template is="dom-if" if="{{_cmdTypeName.pause}}" restamp="true">
          <div class="input-row">
            <paper-input
              label="Duration"
              value="{{currentCmd.params.duration.value}}"
              placeholder="Enter a duration",
              type="number"
              always-float-label></paper-input>
            <span class="input-unit">{{currentCmd.params.duration.unit}}</span>
          </div>
        </template>


      </paper-dialog-scrollable>

      <!-- Command Dialog Actions -->
      <div class="buttons">
        <paper-button id="cmdDialogCancelButton">Cancel</paper-button>
        <paper-button dialog-confirm autofocus disabled$="{{!cmdTypeIsSelected}}">{{_newCmdDialogCommitButtonText}}</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script src="app-rover-sequence-editor.js" charset="utf-8"></script>
</dom-module>
